<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Replacing Common Photoshop workflows with ImageMagick</title><meta name="description" content="I'm Nick Tomlin, a full stack engineer that loves JavaScript and poetry."><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/about.Mng-hDlY.css"></head> <body> <header class="relative my-4"> <div class="wrapper flex items-center justify-between site-header"> <div class="mt-2"> <a href="/"><img class="max-h-10" src="/images/nt-logo.svg" alt="Nick Tomlin: Full Stack Engineer"></a> </div> <nav class="header-nav space-x-6 ml-8"> <a href="/" class="hover:underline hover:text-brand-secondary transition-all">Home</a> <a href="/about" class="hover:underline hover:text-brand-secondary transition-all">About</a> <a href="/posts" class="hover:underline hover:text-brand-secondary transition-all">Posts</a> </nav> </div> </header> <main>  <div class="page-content"> <div class="wrapper"> <article itemscope itemtype="http://schema.org/BlogPosting"> <header class="my-4"> <h1 class="lead text-5xl mb-3" itemprop="name headline">Replacing Common Photoshop workflows with ImageMagick</h1> <time datetime="Fri Mar 15 2013 19:00:00 GMT-0500 (Central Daylight Time)" itemprop="datePublished">March 16, 2013</time> </header> <div class="post-content prose lg:prose-xl" itemprop="articleBody"> <p>Photoshop is a wonderful tool, but it tends to require mousing (even with shortcuts), likes to eat up as much RAM as possible, and doesn’t play nice with bash scripts. Thats why I prefer <a href="http://www.imagemagick.org/script/index.php">Image Magick</a>: a quirky, insanely full-featured CLI image manipulation library. I’ll run through some examples of using it do a few common tasks that I previously used photoshop for, such as:</p>
<ul>
<li>Identify the size/type of image</li>
<li>Convert image types</li>
<li>Resize images to a maximum width/height</li>
<li>Reduce image filesize</li>
<li>Trim Whitespace</li>
<li>Create new images from scratch</li>
<li>Add borders</li>
</ul>
<p><strong>Example Repository</strong></p>
<p>If you want to follow along, i’ve created an <a href="https://bitbucket.org/nicktomlin/imagemagick-examples/">example repository</a> with some source files. I’ll be referencing them through the post.</p>
<h2 id="installation">Installation</h2>
<h3 id="mac-os-x">Mac Os X</h3>
<p>Mac users can (and should) use <a href="http://mxcl.github.com/homebrew/">brew</a> :</p>
<p><code>brew install imagemagick</code></p>
<h3 id="linux">Linux</h3>
<p>Most linux distributions should have the <code>imagemagick</code> package available by default.</p>
<p>For Ubuntu:</p>
<p><code>apt-get install imagemagick</code></p>
<h2 id="there-be-dragons-mogrify-vs-convert">There be dragons: Mogrify Vs. Convert</h2>
<p>One important thing to cover before we start slicing and dicing images is that IM has two  major methods for manipulating images: <code>convert</code> and <code>mogrify</code>. <code>Convert</code> takes a source file, makes whatever changes you desire to it and ouptus them to a file you specify. <code>Mogrify</code> only accepts one file, and makes all changes on that file (unless you specify a destination directory). <code>mogrify</code> has a simpler syntax for performing batch operations on images, but that elegance comes with the potential of deleting precious content. There’s an example of how to handle batch operations using both commands in the “resize” section later on. For now, just be warned that <code>mogrify</code> will write any changes you make to the <strong>original</strong> files. Back up early; back up often.</p>
<h2 id="identify-the-size-and-type-of-images"><a href="http://www.imagemagick.org/script/command-line-options.php#identify">Identify</a> the size and type of images</h2>
<p><code>identify</code> is great for getting a quick overview of an image’s properties.</p>
<p>Our example’s source file includes an image file named <code>300</code>, which i’ve nabbed from <a href="http://placekitten.com/">PlaceKitten</a>. Photoshop doesn’t know what to do with the image, because it is missing an extension, and while we could try and guess the extension by renaming the file to (gif|png|jpg) and seeing what happens, but it’s cooler (and faster) to use the <code>identify</code> command to figure things out:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="shell"><code><span class="line"><span style="color:#B392F0">identify</span><span style="color:#79B8FF"> 300</span></span>
<span class="line"><span style="color:#B392F0">300</span><span style="color:#9ECBFF"> JPEG</span><span style="color:#9ECBFF"> 200x200</span><span style="color:#9ECBFF"> 200x200+0+0</span><span style="color:#9ECBFF"> 8-bit</span><span style="color:#9ECBFF"> sRGB</span><span style="color:#9ECBFF"> 8KB</span><span style="color:#9ECBFF"> 0.000u</span><span style="color:#9ECBFF"> 0:00.009</span></span></code></pre>
<p>Ah, a jpeg. I suspected it all along.</p>
<h3 id="formatting-identifys-output">Formatting identify’s output</h3>
<p>The default output of the <code>identify</code> command is a little verbose for my taste. We can trim it down by using IM built in <code>-format</code> <a href="http://www.imagemagick.org/script/escape.php">escapes</a></p>
<pre><code> # Print the name, and dimensions of the file named 300
  identify -format "Name: %f Dimensions: %P Type: %m" 300 </code></pre>
<p>Batch identification is simple with your shell’s built in <a href="http://wiki.bash-hackers.org/syntax/expansion/globs">globbing</a>:</p>
<pre><code>
  # '*' will get you more than you ask for, so it's best to narrow
  # things down based on the file structure you are dealing with
  identify *</code></pre>
<h2 id="convert-image-formats">Convert image formats</h2>
<p>Imagemagick’s powerhouse is the <a href="http://www.imagemagick.org/script/convert.php"><code>convert</code></a> command. You can use it to do almost anything you can imagine through some terrifyingly complex flags. We’ll try to keep things simple : )</p>
<h3 id="convert-from-tiff-to-jpg">Convert from <code>tiff</code> to <code>jpg</code></h3>
<p>Image magick can effortlessly convert images between various formats. A problem one of my coworkers ran into recently involved clients needing images in the <code>tiff</code> format. Photoshop can do batch operations, but the process is clunky, and — in my experience— unreliable.</p>
<h4 id="single-images">Single Images:</h4>
<ul>
<li><code>convert convert.tiff kitten.jpg</code> Simple, no?</li>
</ul>
<h4 id="multiple-images">Multiple Images:</h4>
<ul>
<li>destroying the original image:
<ul>
<li><code>mogrify</code> <code>mogrify --format tiff *.jpg</code></li>
</ul>
</li>
<li>retaining the original image, the <code>mogrify</code> command can be used with the <code>-path</code> flag
<ul>
<li><code>mogrify --format tiff -path converted *.jpg</code></li>
<li>The path (in this case the ‘converted’ directory) must exist, or IM will complain</li>
<li>Make sure that this path is different than the files you are using <code>mogrify</code> on, or they will be overwritten.</li>
</ul>
</li>
<li>retaining the original image, you can use  a long<code>convert</code> statement (see batch resizing below).</li>
</ul>
<h2 id="resize-images">Resize images</h2>
<h3 id="simple-resize">Simple Resize</h3>
<p><code>convert kitten.jpg -resize 80% resized-kitten.jpg</code></p>
<h3 id="batch-resizing">Batch Resizing</h3>
<p>Clients rarely have a images in a uniform, web-optimized format, and even if they do I usually need need two copies: retina-ready images, and images for us normal folks. ImageMagick makes generating those a snap.</p>
<p>In our <code>resize/batch</code> folder:</p>
<p><code>convert *.jpg -resize 80% -set filename:f '%t@2x' '%[filename:f].jpg'</code></p>
<p>Here we are resizing all jpg images by 80%, setting the filename the filename <code>%t</code> plus the string <code>@2x</code> to follow apple’s convention for retina images, and then outputting the file. The syntax is a little esoteric (more details on that <a href="http://www.imagemagick.org/Usage/files/#save_escapes">here</a>), but once you get the hang of it it can be quite useful.</p>
<p>We can now run <code>mogrify !(*@2x).jpg -resize 40%</code> to cut the non retina images down to size (note, this will “destroy” the original images — I have a backup handy).</p>
<h3 id="resizing-to-a-maximum-pixel-width">Resizing to a maximum pixel width</h3>
<p>If you have do not have a specific size for your images, but want to keep things small, you can use the following syntax:</p>
<p>In our <code>resize</code> folder, there is a max width image. Running identify gives us the following:</p>
<p><code>max-width.jpg JPEG 408x287 408x287+0+0 8-bit sRGB 15.8KB 0.000u 0:00.000</code></p>
<p>Let’s resize that to a max width of 200px:</p>
<p><code>convert max-width.jpg -resize 200\> max-width-resized.jpg</code></p>
<p>One special thing to note is the icky need for the <code>\</code> in <code>\></code>. This is necessary to escape to prevent your shell from interpreting that as an output redirection <code>></code>.</p>
<h3 id="replacing-save-for-web-and-reducing-file-size-with--strip">Replacing “save-for-web” and reducing file size with <code>-strip</code></h3>
<p>When resizing images (especially large images), you may notice that the file size of the images does not decrease as much as you might expect. This is typically due  the meta-data and other kruft that may come attached to your image file. Using the <code>-strip</code> flag on any IM operation will remove this data, which, in my experience, typically results in a 10-30% reduction in size.</p>
<p>In our <code>trim</code> folder:
<code>convert -strip strip.jpg stripped.jpg</code></p>
<p>Use <code>identify</code> to compare the file sizes. Not a huge reduction (this image is pretty slim already), but imagine those percentage savings being applied to a larger image.</p>
<p>Obviously, Photoshop’s “Save for web” combines resizing and optimizing functions, but you can too.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="plaintext"><code><span class="line"><span>convert sample.png -strip -resize 80% optimized.png</span></span></code></pre>
<h2 id="borders">Borders</h2>
<p>Add a 5px black border to an image.</p>
<p>In our <code>borders</code> folder:</p>
<p><code>convert kitten.jpg -bordercolor '#000' -border 5 bordered.jpg</code></p>
<h2 id="trim-whitespace">Trim Whitespace</h2>
<p>My jaw dropped when I first found out about this command (thanks to <a href="http://hilbertastronaut.blogspot.com/2008/08/imagemagick-crops-your-white-space.html">this</a> brilliant gentleman)</p>
<p>In our <code>trim-whitespace</code> folder</p>
<p><code>convert trim.png -trim trimmed.png</code></p>
<p>Unfortunately, for images with gradients, or subtle transitions between subject/background, the results are not quite as spectacular:</p>
<p><code>convert not-quite-trim.jpg -trim not-quite-trimmed.jpg</code></p>
<p>Will output an image that still has a background bleed :(</p>
<h2 id="create-images-from-the-command-line">Create Images from the command line</h2>
<p>Imagemagick can also help you with bespoke iamges as well, if you need some filler content and can’t use a service like placehold.it or (my favorite) placekitten.com.</p>
<p>To create a simple gray (usinga hex value), sized 100x100 you can use the convert command.</p>
<ul>
<li>
<p>Solid Color:
<code>convert -size 100x100 canvas:#a19c9e canvas.png</code>
(note, you may need to quote/escape hex colors, as your shell may try glob them)</p>
</li>
<li>
<p>Gradient:
<code>convert -size 100x100 gradient:#a19c9e-#000000 canvas.png</code></p>
</li>
<li>
<p>Pattern:
<code>convert -size 100x100 pattern:HEXAGONS canvas.png</code></p>
</li>
</ul>
<p>There are a host of options <a href="http://www.imagemagick.org/script/formats.php">here</a></p>
<h2 id="the-start-of-a-beautiful-friendship">The start of a beautiful friendship</h2>
<p>Hopefully these examples have whet your appetite for handling images on the command line. IM can do so so much more, and all those features are listed in
IM’s <a href="http://www.imagemagick.org/script/command-line-processing.php#sequence">extensive documentation</a>.</p>
<h2 id="notes">Notes</h2>
<h3 id="os-x-users-sips">Os X Users: <code>sips</code></h3>
<p>If you don’t want to bother installing IM, or you are on a friend’s Macbook and can’t. Use the built-in utility <code>sips</code> to do some batch image processing. While not as robust as ImageMagick, it suffice in a pinch. More on that <a href="https://developer.apple.com/library/mac/#documentation/Darwin/Reference/ManPages/man1/sips.1.html">here</a>.</p>
<h3 id="im-and-build-processes">IM and Build Processes</h3>
<p>While IM is an excellent choice for performing large batch operations on images, it has been my experience that it is better suited for one off batch jobs than a constant build/deploy process. I’d suggest using tools like the <a href="https://github.com/h5bp/ant-build-script">HTML5 BoilerPlate Build script</a> or <a href="http://gruntjs.com/">Grunt</a> with the <a href="https://github.com/gruntjs/grunt-contrib-imagemin">grunt-contrib-imgmin</a> plugin on projects that may need to consistently run and rerun optimization.</p>
<h3 id="a-note-on-performance">A note on Performance</h3>
<p>ImageMagick has a more performant fork <a href="http://www.graphicsmagick.org/benchmarks.html">GraphicsMagick</a> if you are concerned about keeping resource usage down or if you are <a href="http://codeascraft.etsy.com/2010/07/09/batch-processing-millions-of-images/">etsy</a>. Most of the commands are similar, but the differences between the command structure and GM’s elusive api documentation make starting with imageMagick a better fit. You can always move on to GM when performance becomes a concern.</p>
<h2 id="corrections">Corrections</h2>
<p>If you are a command-line master, and i’ve missed something or missed a performant shortcut, don’t hesitate to note it in the comments. Or open an <a href="https://bitbucket.org/nicktomlin/imagemagick-examples/issues?status=new&#x26;status=open">issue</a></p> </div> <footer class="my-10"> <div> <a href="/posts" class="py-1 px-4 rounded-md bg-brand-primary text-white no-underline">
More posts
</a> </div> <div class="my-4"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z2kSyk" prefix="r1" component-url="/_astro/DisqusComments.9-ilZC2Y.js" component-export="default" renderer-url="/_astro/client.BNKbhxCX.js" props="{&quot;shortname&quot;:[0,&quot;nick-tomlin&quot;],&quot;config&quot;:[0,{&quot;locale&quot;:[0,&quot;en_US&quot;],&quot;identifier&quot;:[0,&quot;/2013/03/16/replacing-common-photoshop-workflows-with-imagemagick&quot;],&quot;title&quot;:[0,&quot;Replacing Common Photoshop workflows with ImageMagick&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;DisqusComments&quot;,&quot;value&quot;:true}" await-children><div id="disqus_thread"></div><!--astro:end--></astro-island> </div> </footer> </article> </div> </div>  </main> <!-- Empty footer for now --> </body></html>