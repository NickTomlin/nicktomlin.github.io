<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Migrating from Jekyll to Next.js: Technical Challenges</title><meta name="description" content="I'm Nick Tomlin, a full stack engineer that loves JavaScript and poetry."><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/about.D3jOyiIK.css"></head> <body> <header class="relative my-4 min-h-56"> <div class="wrapper flex items-center justify-between site-header"> <div class="mt-2"> <a href="/"><img class="max-h-10" src="/images/nt-logo.svg" alt="Nick Tomlin: Full Stack Engineer"></a> </div> <nav class="header-nav space-x-6 ml-8"> <a href="/" class="hover:underline hover:text-brand-secondary transition-all">Home</a> <a href="/about" class="hover:underline hover:text-brand-secondary transition-all">About</a> <a href="/posts" class="hover:underline hover:text-brand-secondary transition-all">Posts</a> </nav> </div> </header> <main>  <div class="page-content"> <div class="wrapper"> <article itemscope itemtype="http://schema.org/BlogPosting"> <header class="my-4"> <h1 class="lead text-5xl mb-3" itemprop="name headline">Migrating from Jekyll to Next.js: Technical Challenges</h1> <time datetime="Sun Jan 24 2021 18:00:00 GMT-0600 (Central Standard Time)" itemprop="datePublished">Invalid DateTime</time> </header> <div class="post-content prose lg:prose-xl" itemprop="articleBody"> <p>This post describes technical details of migrating from <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://pages.github.com/">Github Pages</a> to <a href="https://nextjs.org"><code>next.js</code></a> and <a href="https://www.netlify.com/">netlify</a>. For the story of the migration, see <a href="/posts/migrating-from-jekyll-to-next-js-initial-thoughts">the sibling post</a>.</p>
<h1 id="the-work">The work</h1>
<p>I had a very simple Jekyll site and I wanted to move it to Next.js. The work was relatively straightforward, but there were some hiccups.</p>
<h2 id="converting-from-liquid-to-jsx">Converting from liquid to JSX</h2>
<p>This was something I had to do manually. For some pages, I could simply <code>mv foo.html foo.jsx</code> but for others that used a lot of liquid syntax, I needed to replicate the logic in JavaScript/JSX. This wasn’t too bad:</p>
<p>This liquid template:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="html"><code><span class="line"></span>
<span class="line"><span style="color:#E1E4E8">{% for post in site.posts limit:6 %}</span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">li</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">span</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"post-meta"</span><span style="color:#E1E4E8">>{{ post.date | date: "%b %-d, %Y" }}&#x3C;/</span><span style="color:#85E89D">span</span><span style="color:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">h4</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">a</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"post-link"</span><span style="color:#B392F0"> href</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"{{ post.url | prepend: site.baseurl }}"</span><span style="color:#E1E4E8">>{{ post.title }}&#x3C;/</span><span style="color:#85E89D">a</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">h4</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">li</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">{% endfor %}</span></span>
<span class="line"></span></code></pre>
<p>became:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#E1E4E8"> {posts.</span><span style="color:#B392F0">slice</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">post</span><span style="color:#F97583"> =></span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#6A737D">   /* additional markup omitted for brevity... */</span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#79B8FF">Date</span><span style="color:#B392F0"> date</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{post.date} /></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#79B8FF">Link</span><span style="color:#B392F0"> className</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"text-lg"</span><span style="color:#B392F0"> href</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{post.href}>{post.title}&#x3C;/</span><span style="color:#79B8FF">Link</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">))}</span></span></code></pre>
<p>There may be some magical Liquid to JSX converter out there, but writing one was not worth my time for this project.</p>
<h2 id="converting-slugs">Converting slugs</h2>
<p>My Jekyll site had deeply nested post slugs in the format of <code>[year]/[month]/[day]/[id]</code>. I initially went down the route of replicating this pattern, but decided to simplify to just <code>[id]</code>. There were two reasons for this:</p>
<ul>
<li>The “convention based” nested routes in <code>next.js</code> made generating and navigating between posts complicated, especially with file-based static site generation</li>
<li>For a low throughput blog like mine, the granularity of <code>[year]/[month]/[day]/[id]</code> was overkill and not a good look anyway</li>
</ul>
<p>If you happen to need that granularity, by all means use either nested directories and a compound Key in <code>next.js</code> but know that it will make your content a little more complicated for it.</p>
<h3 id="managing-redirects">Managing redirects</h3>
<p>While simplifying the url made things easier (and more readable IMHO), it broke SEO. To get around this, I wrote a <a href="https://github.com/NickTomlin/nicktomlin.github.io/blob/master/scripts/migrate-posts.js">script</a> to harness <code>netflify</code>’s <a href="https://docs.netlify.com/routing/redirects/#syntax-for-the-redirects-file">redirect file</a> a to preserve some semblance of this after the migration.</p>
<h2 id="implementing-markdown">Implementing markdown</h2>
<p>Out of the box, Jekyll supports markdown with <a href="https://kramdown.gettalong.org/">Kramdown</a> and syntax highlighting in code snippets with <a href="http://rouge.jneen.net/">rouge</a>. Next.js has no support for this, but adding it is trivial.  I replaced <a href="https://kramdown.gettalong.org/">Kramdown</a> with <a href="https://github.com/remarkjs/remark">remark</a> and Rouge with <a href="https://prismjs.com/"><code>prism</code></a>.</p>
<p>Normally I would have balked at all this work, but because of the fact that <code>next.js</code> is built like a React app, assembling these pieces was easy. I wasn’t dealing with weird <code>next.js</code> plugins or overriding things with custom config blobs; just writing application code. All that functionality boiled down to about <a href="https://github.com/NickTomlin/nicktomlin.github.io/blob/master/lib/markdown.js#L5-L13">10 lines of code</a>.</p>
<p>Converting the existing posts was done through a <a href="https://github.com/NickTomlin/nicktomlin.github.io/blob/master/scripts/migrate-posts.js">a script</a>.</p>
<h2 id="reloading-on-markdown-changes">Reloading on markdown changes</h2>
<p>Jekyll automatically re-builds a site on changes to posts. It’s slow, and doesn’t refresh the browser, but it works. Next has blazing fast reloads for JS files, but doesn’t know how to watch things outside of your application code (like my <code>posts</code> directory in this case). I was able to get this working using the <a href="https://github.com/hashicorp/next-remote-watch">next-remote-watch</a> module.
So far, everything is fine, although there are some major caveats because it depends on internal APIs.</p>
<h1 id="the-long-and-winding-road">The long and winding road</h1>
<p>At the end of the day, I still just have a basic blog that is written in Markdown. But I’ve gained greater flexibility in how I style and process my content, as well as moving to a toolchain that is closer to my day to day work (especially now that I no longer get paid to write Ruby).</p> </div> <footer class="my-10"> <div> <a href="/posts" class="py-1 px-4 rounded-md bg-brand-primary text-white no-underline">
More posts
</a> </div> <div class="my-4"> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z2e0Ahc" prefix="r1" component-url="/_astro/DisqusComments.9-ilZC2Y.js" component-export="default" renderer-url="/_astro/client.BNKbhxCX.js" props="{&quot;shortname&quot;:[0,&quot;nick-tomlin&quot;],&quot;config&quot;:[0,{&quot;locale&quot;:[0,&quot;en_US&quot;],&quot;identifier&quot;:[0,&quot;my-migrating-from-jekyll-to-next-technical-challenges&quot;],&quot;title&quot;:[0,&quot;Migrating from Jekyll to Next.js: Technical Challenges&quot;]}]}" ssr client="load" opts="{&quot;name&quot;:&quot;DisqusComments&quot;,&quot;value&quot;:true}" await-children><div id="disqus_thread"></div><!--astro:end--></astro-island> </div> </footer> </article> </div> </div>  </main> <!-- Empty footer for now --> </body></html>