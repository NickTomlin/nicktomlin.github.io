<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Replacing Common Photoshop workflows with ImageMagick</title>
  <meta name="description" content="Photoshop is a wonderful tool, but it tends to require mousing (even with shortcuts), likes to eat up as much RAM as possible, and doesn’t play nice with bas...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://nick-tomlin.com/2013/03/16/replacing-common-photoshop-workflows-with-imagemagick/">
  <link rel="alternate" type="application/rss+xml" title="Nick Tomlin: Full Stack Engineer" href="http://nick-tomlin.com/feed.xml">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-31147245-1', 'auto');
  ga('send', 'pageview');
</script>

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/"><img class="site-logo" src="/images/nt-logo.svg" alt="Nick Tomlin: Full Stack Engineer"></a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
            
            <a class="page-link" href="/about/">About</a>
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
        
          
            
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Replacing Common Photoshop workflows with ImageMagick</h1>
    <p class="post-meta"><time datetime="2013-03-16T17:00:00+00:00" itemprop="datePublished">Mar 16, 2013</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Photoshop is a wonderful tool, but it tends to require mousing (even with shortcuts), likes to eat up as much RAM as possible, and doesn’t play nice with bash scripts. Thats why I prefer <a href="http://www.imagemagick.org/script/index.php">Image Magick</a>: a quirky, insanely full-featured CLI image manipulation library. I’ll run through some examples of using it do a few common tasks that I previously used photoshop for, such as:</p>

<ul>
  <li>Identify the size/type of image</li>
  <li>Convert image types</li>
  <li>Resize images to a maximum width/height</li>
  <li>Reduce image filesize</li>
  <li>Trim Whitespace</li>
  <li>Create new images from scratch</li>
  <li>Add borders</li>
</ul>

<p><strong>Example Repository</strong></p>

<p>If you want to follow along, i’ve created an <a href="https://bitbucket.org/nicktomlin/imagemagick-examples/">example repository</a> with some source files. I’ll be referencing them through the post.</p>

<h2 id="installation">Installation</h2>

<h3 id="mac-os-x">Mac Os X</h3>
<p>Mac users can (and should) use <a href="http://mxcl.github.com/homebrew/">brew</a> :</p>

<p><code class="highlighter-rouge">
brew install imagemagick
</code></p>
<h3 id="linux">Linux</h3>

<p>Most linux distributions should have the <code class="highlighter-rouge">imagemagick</code> package available by default.</p>

<p>For Ubuntu:</p>

<p><code class="highlighter-rouge">apt-get install imagemagick</code></p>

<h2 id="there-be-dragons-mogrify-vs-convert">There be dragons: Mogrify Vs. Convert</h2>
<p>One important thing to cover before we start slicing and dicing images is that IM has two  major methods for manipulating images: <code class="highlighter-rouge">convert</code> and <code class="highlighter-rouge">mogrify</code>. <code class="highlighter-rouge">Convert</code> takes a source file, makes whatever changes you desire to it and ouptus them to a file you specify. <code class="highlighter-rouge">Mogrify</code> only accepts one file, and makes all changes on that file (unless you specify a destination directory). <code class="highlighter-rouge">mogrify</code> has a simpler syntax for performing batch operations on images, but that elegance comes with the potential of deleting precious content. There’s an example of how to handle batch operations using both commands in the “resize” section later on. For now, just be warned that <code class="highlighter-rouge">mogrify</code> will write any changes you make to the <strong>original</strong> files. Back up early; back up often.</p>

<h2 id="identify-the-size-and-type-of-images"><a href="http://www.imagemagick.org/script/command-line-options.php#identify">Identify</a> the size and type of images</h2>
<p><code class="highlighter-rouge">identify</code> is great for getting a quick overview of an image’s properties.</p>

<table>
  <tbody>
    <tr>
      <td>Our example’s source file includes an image file named <code class="highlighter-rouge">300</code>, which i’ve nabbed from <a href="http://placekitten.com/">PlaceKitten</a>. Photoshop doesn’t know what to do with the image, because it is missing an extension, and while we could try and guess the extension by renaming the file to (gif</td>
      <td>png</td>
      <td>jpg) and seeing what happens, but it’s cooler (and faster) to use the <code class="highlighter-rouge">identify</code> command to figure things out:</td>
    </tr>
  </tbody>
</table>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>identify 300
300 JPEG 200x200 200x200+0+0 8-bit sRGB 8KB 0.000u 0:00.009
</code></pre></div></div>

<p>Ah, a jpeg. I suspected it all along.</p>

<h3 id="formatting-identifys-output">Formatting identify’s output</h3>
<p>The default output of the <code class="highlighter-rouge">identify</code> command is a little verbose for my taste. We can trim it down by using IM built in <code class="highlighter-rouge">-format</code> <a href="http://www.imagemagick.org/script/escape.php">escapes</a></p>

<pre><code> # Print the name, and dimensions of the file named 300
  identify -format "Name: %f Dimensions: %P Type: %m" 300 </code></pre>

<p>Batch identification is simple with your shell’s built in <a href="http://wiki.bash-hackers.org/syntax/expansion/globs">globbing</a>:</p>

<pre><code>
  # '*' will get you more than you ask for, so it's best to narrow
  # things down based on the file structure you are dealing with
  identify *</code></pre>
<h2 id="convert-image-formats">Convert image formats</h2>
<p>Imagemagick’s powerhouse is the <a href="http://www.imagemagick.org/script/convert.php"><code class="highlighter-rouge">convert</code></a> command. You can use it to do almost anything you can imagine through some terrifyingly complex flags. We’ll try to keep things simple : )</p>

<h3 id="convert-from-tiff-to-jpg">Convert from <code class="highlighter-rouge">tiff</code> to <code class="highlighter-rouge">jpg</code></h3>

<p>Image magick can effortlessly convert images between various formats. A problem one of my coworkers ran into recently involved clients needing images in the <code class="highlighter-rouge">tiff</code> format. Photoshop can do batch operations, but the process is clunky, and — in my experience— unreliable.</p>

<h4 id="single-images">Single Images:</h4>
<ul>
  <li><code class="highlighter-rouge">convert convert.tiff kitten.jpg</code> Simple, no?</li>
</ul>

<h4 id="multiple-images">Multiple Images:</h4>
<ul>
  <li>destroying the original image:
    <ul>
      <li><code class="highlighter-rouge">mogrify</code> <code class="highlighter-rouge">mogrify --format tiff *.jpg</code></li>
    </ul>
  </li>
  <li>retaining the original image, the <code class="highlighter-rouge">mogrify</code> command can be used with the <code class="highlighter-rouge">-path</code> flag
    <ul>
      <li><code class="highlighter-rouge">mogrify --format tiff -path converted *.jpg</code></li>
      <li>The path (in this case the ‘converted’ directory) must exist, or IM will complain</li>
      <li>Make sure that this path is different than the files you are using <code class="highlighter-rouge">mogrify</code> on, or they will be overwritten.</li>
    </ul>
  </li>
  <li>retaining the original image, you can use  a long<code class="highlighter-rouge">convert</code> statement (see batch resizing below).</li>
</ul>

<h2 id="resize-images">Resize images</h2>

<h3 id="simple-resize">Simple Resize</h3>

<p><code class="highlighter-rouge">convert kitten.jpg -resize 80% resized-kitten.jpg</code></p>

<h3 id="batch-resizing">Batch Resizing</h3>

<p>Clients rarely have a images in a uniform, web-optimized format, and even if they do I usually need need two copies: retina-ready images, and images for us normal folks. ImageMagick makes generating those a snap.</p>

<p>In our <code class="highlighter-rouge">resize/batch</code> folder:</p>

<p><code class="highlighter-rouge">convert *.jpg -resize 80% -set filename:f '%t@2x' '%[filename:f].jpg'</code></p>

<p>Here we are resizing all jpg images by 80%, setting the filename the filename <code class="highlighter-rouge">%t</code> plus the string <code class="highlighter-rouge">@2x</code> to follow apple’s convention for retina images, and then outputting the file. The syntax is a little esoteric (more details on that <a href="http://www.imagemagick.org/Usage/files/#save_escapes">here</a>), but once you get the hang of it it can be quite useful.</p>

<p>We can now run <code class="highlighter-rouge">mogrify !(*@2x).jpg -resize 40%</code> to cut the non retina images down to size (note, this will “destroy” the original images – I have a backup handy).</p>

<h3 id="resizing-to-a-maximum-pixel-width">Resizing to a maximum pixel width</h3>
<p>If you have do not have a specific size for your images, but want to keep things small, you can use the following syntax:</p>

<p>In our <code class="highlighter-rouge">resize</code> folder, there is a max width image. Running identify gives us the following:</p>

<p><code class="highlighter-rouge">max-width.jpg JPEG 408x287 408x287+0+0 8-bit sRGB 15.8KB 0.000u 0:00.000</code></p>

<p>Let’s resize that to a max width of 200px:</p>

<p><code class="highlighter-rouge">convert max-width.jpg -resize 200\&gt; max-width-resized.jpg</code></p>

<p>One special thing to note is the icky need for the <code class="highlighter-rouge">\</code> in <code class="highlighter-rouge">\&gt;</code>. This is necessary to escape to prevent your shell from interpreting that as an output redirection <code class="highlighter-rouge">&gt;</code>.</p>

<h3 id="replacing-save-for-web-and-reducing-file-size-with--strip">Replacing “save-for-web” and reducing file size with <code class="highlighter-rouge">-strip</code></h3>

<p>When resizing images (especially large images), you may notice that the file size of the images does not decrease as much as you might expect. This is typically due  the meta-data and other kruft that may come attached to your image file. Using the <code class="highlighter-rouge">-strip</code> flag on any IM operation will remove this data, which, in my experience, typically results in a 10-30% reduction in size.</p>

<p>In our <code class="highlighter-rouge">trim</code> folder:
<code class="highlighter-rouge">convert -strip strip.jpg stripped.jpg</code></p>

<p>Use <code class="highlighter-rouge">identify</code> to compare the file sizes. Not a huge reduction (this image is pretty slim already), but imagine those percentage savings being applied to a larger image.</p>

<p>Obviously, Photoshop’s “Save for web” combines resizing and optimizing functions, but you can too.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>convert sample.png -strip -resize 80% optimized.png
</code></pre></div></div>

<h2 id="borders">Borders</h2>
<p>Add a 5px black border to an image.</p>

<p>In our <code class="highlighter-rouge">borders</code> folder:</p>

<p><code class="highlighter-rouge">convert kitten.jpg -bordercolor '#000' -border 5 bordered.jpg</code></p>

<h2 id="trim-whitespace">Trim Whitespace</h2>

<p>My jaw dropped when I first found out about this command (thanks to <a href="http://hilbertastronaut.blogspot.com/2008/08/imagemagick-crops-your-white-space.html">this</a> brilliant gentleman)</p>

<p>In our <code class="highlighter-rouge">trim-whitespace</code> folder</p>

<p><code class="highlighter-rouge">convert trim.png -trim trimmed.png</code></p>

<p>Unfortunately, for images with gradients, or subtle transitions between subject/background, the results are not quite as spectacular:</p>

<p><code class="highlighter-rouge">convert not-quite-trim.jpg -trim not-quite-trimmed.jpg</code></p>

<p>Will output an image that still has a background bleed :(</p>

<h2 id="create-images-from-the-command-line">Create Images from the command line</h2>
<p>Imagemagick can also help you with bespoke iamges as well, if you need some filler content and can’t use a service like placehold.it or (my favorite) placekitten.com.</p>

<p>To create a simple gray (usinga hex value), sized 100x100 you can use the convert command.</p>

<ul>
  <li>
    <p>Solid Color:
<code class="highlighter-rouge">convert -size 100x100 canvas:#a19c9e canvas.png</code>
(note, you may need to quote/escape hex colors, as your shell may try glob them)</p>
  </li>
  <li>
    <p>Gradient:
<code class="highlighter-rouge">convert -size 100x100 gradient:#a19c9e-#000000 canvas.png</code></p>
  </li>
  <li>
    <p>Pattern:
<code class="highlighter-rouge">convert -size 100x100 pattern:HEXAGONS canvas.png</code></p>
  </li>
</ul>

<p>There are a host of options <a href="http://www.imagemagick.org/script/formats.php">here</a></p>

<h2 id="the-start-of-a-beautiful-friendship">The start of a beautiful friendship</h2>
<p>Hopefully these examples have whet your appetite for handling images on the command line. IM can do so so much more, and all those features are listed in
IM’s <a href="http://www.imagemagick.org/script/command-line-processing.php#sequence">extensive documentation</a>.</p>

<h2 id="notes">Notes</h2>

<h3 id="os-x-users-sips">Os X Users: <code class="highlighter-rouge">sips</code></h3>
<p>If you don’t want to bother installing IM, or you are on a friend’s Macbook and can’t. Use the built-in utility <code class="highlighter-rouge">sips</code> to do some batch image processing. While not as robust as ImageMagick, it suffice in a pinch. More on that <a href="https://developer.apple.com/library/mac/#documentation/Darwin/Reference/ManPages/man1/sips.1.html">here</a>.</p>

<h3 id="im-and-build-processes">IM and Build Processes</h3>
<p>While IM is an excellent choice for performing large batch operations on images, it has been my experience that it is better suited for one off batch jobs than a constant build/deploy process. I’d suggest using tools like the <a href="https://github.com/h5bp/ant-build-script">HTML5 BoilerPlate Build script</a> or <a href="http://gruntjs.com/">Grunt</a> with the <a href="https://github.com/gruntjs/grunt-contrib-imagemin">grunt-contrib-imgmin</a> plugin on projects that may need to consistently run and rerun optimization.</p>

<h3 id="a-note-on-performance">A note on Performance</h3>
<p>ImageMagick has a more performant fork <a href="http://www.graphicsmagick.org/benchmarks.html">GraphicsMagick</a> if you are concerned about keeping resource usage down or if you are <a href="http://codeascraft.etsy.com/2010/07/09/batch-processing-millions-of-images/">etsy</a>. Most of the commands are similar, but the differences between the command structure and GM’s elusive api documentation make starting with imageMagick a better fit. You can always move on to GM when performance becomes a concern.</p>

<h2 id="corrections">Corrections</h2>
<p>If you are a command-line master, and i’ve missed something or missed a performant shortcut, don’t hesitate to note it in the comments. Or open an <a href="https://bitbucket.org/nicktomlin/imagemagick-examples/issues?status=new&amp;status=open">issue</a></p>


  </div>
</article>


  <div id="disqus_thread"></div>
<script>
  (function() {
    var disqus_config = function () {
      this.page.url = '/2013/03/16/replacing-common-photoshop-workflows-with-imagemagick/';
      this.page.identifier = '/2013/03/16/replacing-common-photoshop-workflows-with-imagemagick';
    }
    var d = document, s = d.createElement('script');

    s.src = '//nicktomlin.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Nick Tomlin: Full Stack Engineer</li>
          <li><a href="mailto:nick.tomlin+web@gmail.com">nick.tomlin+web@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/nicktomlin"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">nicktomlin</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/itsnicktomlin"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">itsnicktomlin</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>I'm Nick Tomlin, a full stack engineer in Chicago. I like JavaScript.</p>
      </div>
    </div>

  </div>

</footer>

    <script src="/javascript/index.bundle.js"></script>

  </body>

</html>
